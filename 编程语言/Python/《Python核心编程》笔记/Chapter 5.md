# Chapter 5 {#Chapter_5}

## 数字类型

数字类型提供了标量存储和直接访问。它是不可修改类型。

Python支持多种数字类型：

* 整型
* 长整型
* 布尔型
* 双精度浮点型
* 十进制浮点型
* 复数

Python中变量的重新赋值，实际上并没有改变原来对象的值，因为数字对象是不可变的。在赋值的时候实际上是产生了一个新的数值对象，并把它的引用赋值给这个变量。

Python中使用 *del* 语句删除一个数值对象的引用，所以 *del* 语句并不总是会删除一个对象，只有当这个对象的引用计数为0的时候，这个对象才会被回收机制回收。

### 整型

Python中有几种整数类型，布尔型是整形的一种，是一种只有两个值得整型。(在Python3中int类型和long类型已经整合到一起了，没有long类型了)

### 布尔型

Python从版本2.3开始支持布尔类型，该类型只有两个值：**True**和**False**。

### 长整型

在Python中的长整型和C语言中的长整型是不同的，在Python中长整型可以表示的整数的范围要大得多。在一个整型的后面添加一个**L**或**l**表示该对象是一个长整型数

~~~

1024L

1024l

~~~

在Python3中，长整型数和整型数已经统一，在Python3中没有了long类型，只有int类型。

### 双精度浮点数

Python中的浮点数类似于double类型，是双精度类型，可以直接用十进制或科学记数法表示。每个浮点数占8个字节，遵循IEEE754号规范(52M/11E/1S)，其中M表示底，E表示指数，S表示符号，但是实际进度依赖于机器架构和创建Python解释器的编译器。

### 复数

Python中的复数：

* 虚数不能单独存在，他们总是和一个值为0.0的实数部分一起构建一个复数。
* 复数由实数部分和虚数部分构成：
    * 表示虚数的语法是：real + imagj
    * 实数部分和虚数部分都是浮点数
    * 虚数部分必须有后缀j或J


#### 复数的内建属性

复数对象有数据属性，分别为复数的实部和虚部。复数还拥有**conjugate()**方法，调用该函数可以返回该复数的共轭对象。

复数属性：
num.real	
:   复数的实部

num.imag	
:   复数的虚部

num.conjugate()	
:   返回共轭复数

## 运算符

### 混合模式运算符

Python使用数字类型强制转换的方法解决数字类型不一致的问题。强制类型转换遵循基本的规则：

* 如果两个操作数的数据类型相同，则不进行类型转换。
* 当两个操作数类型不同时，Python检查一个操作数是否可以转换为另一个操作数:
    * 如果可以，转换它并返回转换结果。有些转换是不可能实现的，如：将一个负数转换为非负数，将一个浮点数转换为整数等。
* 将一个整数转换为浮点数，只要在整数后面添加(.0)。
* 将一个非复数转换为复数，则只要在实部后面加上一个(0j)表示的虚部。


这些类型的转换的基本规则为：整数可以转换为浮点数，非复数可以转换为复数。

Python的**coerce()**函数将两个参数转换为相同的类型，返回一个元组类型：

~~~

coerce(...)
    coerce(x, y) -> (x1, y1)
    
    Return a tuple consisting of the two numeric arguments converted to
    a common type, using the same rules as used by arithmetic operations.
    If coercion is not possible, raise TypeError.

~~~

**coerce()**函数遵循下面的转换规则：

* 如果一个数是复数，则另一个操作数被转换为复数
* 如果一个操作数是浮点数，另一个操作数被转换为浮点数
* 否则，如果一个操作数是长整型数，另一个操作数被转换为长整型数
* 否则，两个操作数必然是普通整型数，无需转换。

### 算术运算符

Python支持单目运算符正号(+)和负号(-)，双目运算符：+，-，*，/，%，\*\*(乘方)，在Python2.2中增加了一个新的整除运算符//

#### 除法

Python的除法和C语言中的除法不同，Python中的除法是真正的除法。从Python2.2开始，新增的//运算符用于执行向下取整的除法。

Python的除法运算，在Python 2.5的版本中，存在两种除法运算，true除法和floor除法。当使用x/y形式的除法的时候，如果x和y都是整形，那么运算结果会对结果进行截取，如：

~~~

 >>>2/3
 0
~~~

如果x和y中有一个是浮点数，那么就进行true除法：

~~~

 >>> 2 / 3.0
 0.666666666666663

~~~

另外一种除法是采用x//y的形式，表示的是floor除法，即对结果进行向下取整：

~~~

 >>> 2 // 3
 0

 >>> -2 // 3
 -1

 >>> -2.0 // 3
 -1.0

~~~

在Python 3.0中，x/y将只执行true除法，在Python 2.5版本中使用这个特性，通过如下方法：

~~~

from __future__ import division

~~~

#### 取余

Python中的取余操作对于浮点数，余数为该数和取小于等于商的精确值的最大整数的乘积的差，即：**x-(math.floor(x/y) * y)**或者**x-(x//y * y)**。

对于复数，取余类似于浮点数，但是余数仅仅取实数部分。

#### 幂运算符

幂运算符和一元运算符之间的优先级比较特别：幂运算符比其左侧操作数的一元操作符优先级低，比起右操作数的一元操作符的优先级高。

~~~

 >>> -2 ** 2
 -4

 >>> (-2) ** 2
 4

 >>> 2 ** -2
 0.25

~~~

#### 位运算符

注意：位运算符只能应用于整数。

Python支持标准位运算符：

* 取反(~)
* 按位与(&)
* 按位或(|)
* 按位异或(^)
* 左移(<<)
* 右移(>>)

对于长整型数，位运算符使用一种经过修改的2进制补码形式，使得符号位可以无限制的向左扩展。

取反的优先级和数字单目运算符相同，是所有位操作符中优先级最高的一个。左移和右移运算符的优先级次之，单低于加减法运算符，按位与和按位或以及按位异或运算符优先级最低。

## 内建函数和工厂函数

### 标准类型函数

Python中的**cmp()**，**str()**，**type()**内建函数适用于所有的标准类型。

### 数字类型函数

Python中拥有一系列针对数字类型的内建函数。这些函数中一些用于数字类型的转换，另一些用于常用的计算。

#### 转换工厂函数

**bool(obj)**
:   返回obj对象的布尔值，也就是obj.\_\_nonzero\_\_()方法的返回值

**int(obj, base = 10)**
:   返回一个字符串或数值对象的整数表示，类似于string.atoi()函数，从Python1.6后引入可选的进制参数，指定需要被转换的字符串的进制。

**long(obj, base = 10)**
:   返回一个字符或数据对象的长整型表示，类似于string.atol()，从Python1.6后引入可选的进制参数(Python3中将int和long统一了，没有该工厂函数了)

**float(obj)**
:   返回一个字符串或数据对象的浮点数表示，类似于string.atof()

**complex(str)/complex(real, image = 0.0)**
:   返回一个字符串的复数表示，或者根据给定的实数(以及一个可选的虚数部分)生成一个复数对象。

#### 功能函数

Python有5个内建函数用于数值运算:abs(),coerce(),divmod(),pow()和round()。

**abs(num)**
:   返回给定参数的绝对值，如果给定的数一个复数，则返回该复数的模。

**coerce(num1, num2)**
:   将num1和num2转换为同一类型，然后以一个元组的形式返回。coerce()函数提供了不依赖于Python解释器，而是自定义两个数值类型转换的方法。

**divmod(num1, num2)**
:   除法和取余运算的结合，返回一个元组(num1//num2, num1 % num2)。对浮点数和复数的商进行向下舍入(复数取实数部分的商)

**pow(num1, num2, mod=1)**
:   取num1的num2次方，如果mod参数提供，则计算结果再对mod进行取余运算

**round(flt, ndig = 0)**
:   接受一个浮点数flt，并对其进行四舍五入，保存ndig位小数。如果不提供ndig参数，则默认小数点后0位，ndig<0 的时候是来对整数部分进行四舍五入，返回的结果是浮点数.

注意：

round(x)函数将一个浮点数x四舍五入为最近的1的倍数，如round(0.4)=0, round(0.6)=1.0如果x距离两个倍数值相等，如round(0.5)距离0和1.0相等，那么：python2把x四舍五入为远离0的最近倍数，如round(0.5)=1, round(-0.5)=-1，python3则会把x四舍五入为最近的偶数倍数，如round(0.5)=0, round(1.5)=2.0, round(2.5)=2.0

###仅用于整数的函数

Python提供了一些仅用于整数的内建函数，这些函数分为两类:用于进制转换，用于ASCII转换

     
#### 进制转换函数

**hex(num)**	
:   将数字转换成十六进制数并以字符串形式返回

**oct(num)**
:   将数字转换成八进制数并以字符串形式返回


#### ASCII转换函数

**chr(num)**	
:   将ASCII值的数字转换为ASCII字符，范围为0~255

**unichr(num)**	
:   将Unicode码值转换为相应的Unicode字符，范围依赖于Python是构建于USC-2还是USC-4

**ord(chr)**	
:   将一个ASCII或Unicode字符(长度为1的字符串)转换为相应的ASCII或Unicode值


## 其他数字类型

### 十进制浮点数

从Python2.4起十进制浮点数称谓Python的一个特性，用于解决浮点数舍入出错问题。十进制浮点数可以表示更广的精度，为了使用十进制浮点数，需要导入**decimal**模块才能使用**decimal**类。

## 相关模块

在Python标准库中有不少专门用于处理数值类型对象的模块，它们增强并扩展了内建函数的功能和数值运算的功能，下面列出了几个核心的模块：

对于高级数学计算应用，比较著名的第三方包是Numeric(NumPy)和SciPy。

**decimal**
:   十进制浮点数运算类Decimal

**array**
:   高效数值数组(字符，整数，浮点数等)

**math/cmath**
:   标准C库数学运算函数，常规数学运算符在math模块，复数运算在cmath模块

**operator**
:   数学运算符的函数实现

**random**			
:   多种伪随机数生成器，该模块包含多个伪随机数发生器，它们均以当前的时间戳为随机数种子。
